# CH07 데이터 암호화  
  
> 데이터베이스 보안은 중요한데  
> 개발자 입장에서 크게 중요하다기 보다는  
> 큰 흐름만 이해하는 게 좋아보인다.
  
  
# 7.1 MySQL 서버의 데이터 암호화  

당연히 디스크에 저장될 때만 암호화 하면 된다.  
따라서  
MySQL 서버에서 디스크 I/O 과정에서만 데이터 암호화/복호화가 일어난다.    
   
> 공격자가 DB 데이터를 채간다고 해보자.   
> 그러면 Application 내부로 당연히 침투할 수 없을테고,   
> Disk에 저장된 DB 파일을 노리려고 할 것이다.   
> 그러므로    
> 메모리 침투는 OS가 막으니까 디스크 저장될 때만 암호화 하면 된다.     
  
따라서 데이터 암호화를 설정한다고 해서  
DB를 사용하는 개발자 입장에서는 별 차이 없다.  
이러한 방식을 내부 사용자 입장에서는 차이가 없다고 해서 TDE(Transparent Data Encryption) 또는 "Data at Rest Encryption" 이라고 한다.  
  
> Data at Rest 에서 at Rest는  
> 디스크에 저장되어 있다는 뜻에서 at Rest 라고 한다.
  
<br><br>  

# 7.1.1 2단계 키 관리  
  
MySQL 서버의 데이터 암호화는 2가지 방식이 있다.  
  
1. 마스터 키  
2. 테이블스페이스 키
  
테이블 스페이스 키는 MySQL 서버 내부에서 프라이빗 키로 동작해서 외부로 노출되지 않는다.  
따라서 변경하지 않아도 보안 취약점이 없다.  
  
반면 마스터 키 경우 **외부 파일**을 이용하기 때문에 파일 자체가 노출되어서 암호를 뚫을 수 있다.  
따라서 마스터 키는 주기적으로 변경해야 한다.  
  
> 마스터 키 변경시  
> 기존 마스터 키로 복호화 한 다음
> 새 마스터키로 암호화 한다.  
  
 
<br><br>  

# 7.1.2 암호화와 성능  
  
디스크로부터 한 번 읽은 페이지는 버퍼 풀에 적재되는데  
이 때 복호화 된 상태로 적재되기 때문에 성능상에서 최적화 되어있다고 볼 수 있다.  
  
단, 최초로 디스크에 적재되는 경우에는 복호화가 필요하므로  
이 경우 추가로 시간이 걸린다.  
  
> 디스크 저장시에도 복호화 지연이 걸리는데  
> 어차피 디스크에 쓰기 동작은 백그라운드에서 알아서 돌아가므로 쿼리 반응속도에 대한 사용자 경험 입장에서는 지연이 느껴지지는 않는다.
  
<br>  
   
### 압축 후 암호화 된다    
  
Disk - 복호화 - 압축해제 - 압축 - 암호화 - Disk

