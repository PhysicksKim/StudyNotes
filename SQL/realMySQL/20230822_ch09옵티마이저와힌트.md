# CH09 옵티마이저와 힌트  

쿼리 최적화 과정은 단순히 쿼리 문법만 보는 게 아니라  
데이터 저장된 통계도 보고 최적의 실행 계획을 수립한다.  
  
그리고 EXPLAIN 명령으로 쿼리의 실행 계획을 보고 이해하기 위해서  
옵티마이저가 어떻게 동작하는지에 대해서 어느정도 지식을 갖춰야 한다.  
  
따라서 이번 단원은  
MySQL 쿼리 최적화를 이해하기 위해서 충분히 익혀야 한다.    
  
<br><br><br> 
  
---

<br><br><br>  
  
# 9.1 개요  

DBMS 에서 옵티마이저의 동작을 온전히 이해하려면 쉽지않다.    
하지만 실행 계획을 이해해야 쿼리의 문제를 찾고 최적화를 할 수 있다.    
9.1 에서는 실행 계획을 살펴보기 전에 먼저 알고 있어야 할 사항을 보자.  
  
<br><br>  

## 9.1.1 쿼리 실행 절차  
  
MySQL 서버에서 쿼리가 실행되는 과정은 아래와 같다.  
  
1. 개발자가 날린 SQL문을 분해한다 - Parse Tree 만들기  
2. Parse Tree를 보고, 어떤 테이블과 어떤 인덱스를 쓸지 결정한다 - 최적화 및 실행 계획 수립
3. 실행 계획을 보고 스토리지 엔진이 데이터를 가져온다

> 두 번째 단계는 구체적으로 아래와 같은 동작을 처리한다  
> 1. 불필요한 조건 제거, 단순화
> 2. 조인이 있으면, 어떤 순서로 읽을지 결정
> 3. 조건과 인덱스 통계 정보로 인덱스 뭐 쓸지 결정
> 4. 가져온 레코드를 임시 테이블에 넣고 다시 가공할지 결정

<br><br>  

## 9.1.2 옵티마이저의 종류  

### 1. 규칙 기반 최적화(Rule-based optimizer, RBO)    
**"쿼리만"** 보고 최적화 함   
-> 최근에는 잘 사용하지 않음 
  
> (옛날에 오라클 DBMS 에서 사용했다함)    
   
<br>   
    
### 2. 비용 기반 최적화(Cost-based optimizer, CBO)  
데이터 **통계**와 **쿼리**를 **같이** 보고 실행계획 수립    
-> 쿼리 바탕으로 여러 계획을 만들고, 통계를 넣어서 cost를 계산한다      
  
<br><br><br>  

## 9.2 기본 데이터 처리  
  
DB에서 데이터를 어떤 알고리즘으로 처리하는지 본다.  
  
- 풀 테이블 스캔, 풀 인덱스 스캔
- 병렬 처리
- ORDER BY
- GROUP BY
- DISTINCT
- 내부 임시 테이블 활용
  
## 9.2.1 풀 테이블 스캔 / 풀 인덱스 스캔  
