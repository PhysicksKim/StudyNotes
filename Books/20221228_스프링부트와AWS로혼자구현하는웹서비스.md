# 이 책은 Legacy 입니다  

예를들면 스프링은 현재 2.7과 3.0 버전까지 있는데  
이 책은 2.1.7 시절의 스프링을 다루고 있습니다.  
junit 도 현재는 5를 쓰지만 이 책은 4를 다루고 있습니다  
  
따라서 이 책이 시간이 조금 지난 정보를 담고 있으므로(2019년 초판인쇄)  
이 문서를 통해서 현재(2022.12) 시점에서 어떻게 구현하는게 적절할지 기록해두기로 했습니다.  
  
다만 이 책에서 다루는 내용에 능통하지 못하므로, 기술하게될 migration 방식에 문제가 있을 수 있습니다.  
  
<br><br><br>
  
# CH01 springboot 

## 1.4 Gradle 프로젝트를 스프링 부트 프로젝트로 변경하기  
2019년 말에 6.x 버전이 나왔고 이 책의 gradle은 5.x 버전으로 추정됩니다.(74p)   
현재 가장 최신의 gradle은 2022년 11월에 나온 7.6 버전이며  
이 글은 7.4 버전의 gradle을 사용했습니다.  
  
## 책의 gradle 설정 (36p ~ 37p)

### 1. 책에서는 스프링 2.1.7을 사용했지만 저는 2.7.1을 사용하겠습니다. 

### 2. 책에서 쓴 compile() 은 deprecated 됐습니다. implementation 을 사용합니다.
compile 은 deprecated 됐고 아래 표와같이 대체해서 쓰길 권하고 있습니다.  

|compile|runtime|testCompile|testRuntime|
|---|---|---|---|
|implementation (또는 api)|runtimeOnly|testImplementation|testRuntimeOnly|
    
> ### api 와 implementation 차이  
> [블로그 링크](https://kotlinworld.com/317)  
> 간략히 요약하면  
> api(=compile) 를 쓰면 상위 모듈까지 다 가져와서 무거워지고  
> implementation 을 쓰면 해당 모듈만 딱 가져와서 가볍다.  
> ### 그러면 언제 api(=compile)을 써야하나요?  
> [runtimeOnly compileOnly implementation 차이 비교](https://giron.tistory.com/101)  
> 위 글을 참고  
> 요약하면  
> A(main)->B->C 순으로 의존하고 있다 하면  
> runtime에는 A B C 다 알아야 겠지만  
> 개발 및 컴파일 과정에서는 A 와 B만 알면 된다  
> 따라서 개발 단계에서는 B 만 가져오기 위해서 implementation B 해주면 된다  
> 그러나 런타임에는 C 가 필요하므로  
> runtimeOnly C 가 되어야 한다.  

  
### 3. jcenter 는 더이상 사용할 수 없습니다. mavenCentral() 로 대체가능하니다.  

repository는 각종 패키지를 가져오는 곳인데  
mavenCentral과 jcenter 둘 다 적혀있지만  
jcenter는 이제 지원이 중단되어 쓸 수 없습니다   
따라서 그냥 jcenter 부분은 삭제하면 됩니다  
  
### gradle 설정 코드 전문    
```
/*
 ext    : build.gradle에서 사용하는 전역변수를 설정하겠다는 뜻
        springBootVersion 전역변수를 생성하고 그 값을 2.1.7.RELEASE 라고 하겠다라는 뜻이다
*/
buildscript {
    ext {
        springBootVersion = '2.7.1'
    }
    repositories {
        mavenCentral()
        // 책에는 jcenter() 를 쓰라고 하는데
        // 2022/02/11 이후로 deprecated 되어서 쓸 수 없으므로
        // mavencentral() 로 대체했다
        // https://jeroenmols.com/blog/2021/02/04/migratingjcenter/
        mavenCentral()
    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
    }
}

apply plugin: 'java'
apply plugin: 'eclipse'
apply plugin: 'org.springframework.boot'
apply plugin: 'io.spring.dependency-management'

repositories {
    mavenCentral()
}

dependencies {
    // compile() testCompile() 은 gradle 예전에 쓰던거고, implementation() testImplementation() 으로바뀜
    // 참고 링크
    // https://velog.io/@g0709-19/Gradle-Could-not-find-method-compile-%ED%95%B4%EA%B2%B0-%EB%B0%A9%EB%B2%95
    implementation('org.springframework.boot:spring-boot-starter-web')
    
    // 여기 spring-boot-starter-test 에 junit5 가 포함되어있음 (springboot2.2.x 이후버전에는)
    testImplementation('org.springframework.boot:spring-boot-starter-test')
}

test {
    useJUnitPlatform()
}
```

<br><br><br>  

# CH02 TestCode 작성  

## 1. @RunWith() -> @ExtendWith (62p)
```java
// 책의 코드  
@RunWith(SpringRunner.class)
public class HelloControllerTest {
  ...
}
```

```java
@ExtendWith(SpringExtension.class) 
public class HelloControllerTest {
  ...
}
```

## 2. junit test를 위한 MockMVC메서드들 
```java
@Test
public void hello가_리턴된다() throws Exception {
  String hello = "hello";
  
  mvc.perform(get("/hello"))
      .andExpect(status().isOK())
      .andExpect(content().string(hello));
}
```
위 
위 코드에서 .perform() 안에 들어가는 get() 메서드나  
.andExpect() 안에 들어가는 status().isOK() content().string(...) 같은 메서드들은  
전부 junit에 있는 MVCMock 메서드들이다  
  
근데 초보자라면 책에 제대로 안적혀있는 바람에 import를 놓쳐서 에러를 띄우기 쉽다.  
```
cannot find symbol : get
```
이런 에러가 뜰 수 있다.  
  
이거는 그냥 간단하게 import를 해주면 된다  
```
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;
```
\* 로 전부 import 하지 않고 get status content 만 딱 해줘도 된다.  
  
당연히 필요한것만 import 딱 해주는게 좋지만, 자동완성문제때문에 귀찮아서 그냥 \*로 전부 import 해뒀다  
물론 Intellij에 자동완성 설정을 건드릴 수 있겠지만  
MVC test용 Mock 메서드들을 수동으로 import 하는게 학습 차원에서 좋다고 생각해서  
자동완성 설정을 건드리지 않기로 했다.  
  
## 2.3 Lombok 설치하기  
annotation processing 체크 외에도  
아래와 같이 gradle에다가 설정을 추가해줘야한다  

```
dependencies {

    ... 각종 dependencies

    // lombok
    implementation 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    ...

    // lombok test에서 사용
    testImplementation 'org.projectlombok:lombok'
    testAnnotationProcessor 'org.projectlombok:lombok'

}
```
책에서는 그냥 compile 'org.projectlombok:lombok' 만 넣어줬는데  
이러면 lombok 이 테스트에서 제대로 인식이 안된다  
따라서 위와 같이 test에서도 imple 해줘야하고  
추가적으로 AnnotationProcessor 라고 해서 lombok 을 추가해줘야한다  
  


