# 대댓글. 어떻게 구현하지?  
  
대댓글. 모르는 사람이 본다면 "그거 게시판이면 다 있는 거 아냐?" 싶지만   
생각없이 구현했다가는 성능 문제가 일어나기 쉽다.    
  
따라서 어떻게 구현할지 좀 찾아봤다.  
  
<br><br>  
  
# RDB에서 Tree 구조를 만들기 어렵다.    

- Q. 왜 RDB 에서는 Tree 구조 만들기가 어렵지?   

- A. 주소 참조가 안되기 때문이다.    
RDB에서는 다른 Row(=Tuple) 를 직접 특정할 수 없다.    
무슨 말인지 예를 들어보자.  
   
### Java의 경우    
  
```java
MyObject obj = new MyObject();  
// ...
MyObject obj2 = new MyObject();
obj2.setParent(obj);
```  
  
이런 식으로 참조를 통해 곧바로 객체를 특정할 수 있다   
  
### RDB의 경우  
  
하지만 RDB에서는 참조를 가질 수 없고 별도로 값을 지정해야 한다.  
  
|id|name|parentobj_id|
|---|---|---|
|3|obj|null|
|5|obj2|3|
  
이런 식으로 Parent Row의 PK값을 따로 갖고 있어야 한다.  

<br>  

그러므로 DB에서 대댓글을 구현하기 위해 Tree 구조를 구현하려 하면  
결국 어떻게 DB 모델링을 할 것인가가 중요해진다.  
  

<br><br>  
  
# 성능과 데이터 무결성 문제  
    
생각 없이 대댓글 DB 모델링을 하면 성능과 데이터 무결성 문제가 생긴다.  
   
> ### 필요 지식    
> 데이터 무결성, Index, DB Table 정규화  
> 에 대해 모른다면 먼저 따로 공부하고 오자.  
   
### 1) 성능 문제  
Index와 Query를 고려해서 설계해야지 성능 문제를 해결할 수 있다.  
제대로 Index를 탈 수 있도록 설계하고  
Query가 성능문제를 야기하지 않도록(과도한 Join) 설계해야 한다.  

### 2) 데이터 무결성   
정규화는 DB 설계의 기본 중 하나다.  
예를 들어  
댓글 하나는 여러개의 대댓글을 가질 수 있다.  
그렇다고 하나의 row에 중복된 값을 아래와 같이 집어넣으면?  
  
|descent_id|
|---|
|3,5,6|
  
이러면 데이터 원자성이 깨지고 제1정규화를 위반한 모습이 된다.  
  
<br>  

### 그러므로  
무작정 대댓글 DB를 모델링 하면 성능과 데이터 이상현상 문제가 발생한다.  
따라서 **왜? 어떻게? 대댓글 Tree 구조를 RDB에서 구현해낼 것인가** 를 생각해야 한다  
  
<br><br>  
  
# 어떻게 구현할 것인가?  
  
인접목록방식, 경로 열거, 중첩집합, 클로저 테이블(Closure Table), 재귀적 쿼리(Recursive Query)   
등등 다양한 대댓글 구현 방법이 있다.   
  
그러므로 다양한 방법들의 장단점을 파악하고  
구현하고자 하는 게시판과 대댓글 구조에 따라 알맞은 알고리즘을 택해야 한다.    
다만 단점이 너무 큰 방법들도 있다.   
  
예를 들어 인접목록방식 같은 경우   
가장 쉽게 떠올릴 수 있는 방법 중 하나지만  
대댓글이 2단, 3단, ..., n단 이렇게 대댓글의 depth가 끝이 없는 경우  
n번의 join이 사용되야 한다는 말도 안되는 큰 단점이 발생한다.   
  
따라서 정해진 depth 대댓글 까지만 허용되는 경우에는 인접목록방식을 사용할 수 있겠지만  
일반적인 무한 대댓글 구조에서는 인접목록방식을 택할 수 없다.  
  
그러므로 다양한 대댓글 알고리즘의 장단점을 파악해  
알맞은 알고리즘을 택해서 구현하도록 하자.  
  
