[생활코딩 WEB2-Node.js 유튜브 강의](https://www.youtube.com/playlist?list=PLuHgQVnccGMA9QQX5wqj6ThK7t2tsGxjm)


3.1 설치
======
# nodejs 설치과정 , cmd에서 node js 파일 실행해봄


helloworld.js 파일 생성 후 아래 입력
```
console.log(1+1)
```

cmd에서 helloworld.js 파일 경로로 이동후 실행
```
C:\...> node helloworld.js
> 2
```

5.Node.js 웹서버
=========
강의에서 제공하는 소스코드로 main.js 만들고
cmd에서 
```
node main.js
```
입력하고, localhost:3000 으로 웹페이지 입장.

cmd에서 Ctrl + c 로 웹서버 종료

소스코드에 아래 부분 추가
```
    ...
    response.writeHead(200);
    console.log(__dirname + url);
    response.end(fs.readFileSync(__dirname + url));
    ...
```
이렇게 하고 다시 웹서버 켜고 cmd 보면, 페이지 들어 갈 때마다 어떤 파일로 접근하는지 메세지가 뜸


```
    response.end(fs.readFileSync(__dirname + url));
```
response.end() 안에 어떤 코드를 넣느냐에 따라서 
사용자에게 전송하는 정보가 바뀐다

```
    response.end('Physicks web ' + url);
```
같은식으로 바꿀 수 있다.
    

6,7. Javascript 기본 문법
===
그냥 덧셈 곱셈, 변수, console.log(변수), string 등 기본적인 문법

8.Literal
===
JS만의 특수한 문법

예를들어

```
    var Someone = 'Park';
    var MyName = 'Physicks';
    var str = 'Hello ' + Someone + '\n I am ' + MyName;

>   Hello Park
     I am Physicks
```

이렇게 할 수 있지만, 중간에 + 넣고 ' 다시 쳐주고 하는게 귀찮아진다
또 개행도 \n 넣어야 하고 귀찮다.

이걸 Literal을 이용하면

```
    var str = `Hello ${Someone} 
                I am ${MyName}`;
```
이렇게 가독성도 훨씬 좋고, 타이핑도 쉽게 할 수 있다.
또 ${} 안에 다양한 식도 넣을 수 있다.

유의할점은 
작은 따옴표(')가 아니라 숫자 1 옆에 있는 ` 이다.


9.URL의 이해
===

![image](https://user-images.githubusercontent.com/101965836/159617383-a1ca71f5-bb74-4b45-81f9-35b68df953ea.png)

# port
포트는 예제 코드에서
```
app.listen(3000);
```
방식으로 3000번 포트로 지정했기 때문에
**localhost:3000** 으로 접속하게 된다

# path 
컴퓨터 안에 어떤 파일인지 지정함

# query string 
쿼리 스트링 값을 변경하면 웹서버에 데이터를 전달할 수 있다
쿼리 스트링은 ?로 시작하기로 약속
값과 값은 &
값과 이름은 = 쓰기로 약속


10.URL통해서 입력된 값 사용하기
===
쿼리 스트링에 따라 다른 정보를 보여주는 것을 앞으로 할 것이다

그러면 그 전에
클라이언트가 URL 끝에 쿼리스트링 붙인 주소로 접속하면,
서버로는 어떤 요청이 전달될까?

이걸 알아보기 위해서
console.log() 이용해서 queryData를 출력하도록 해보자


먼저
```
...
var app = http.createServer(function(request,response){
    var _url = request.url;
    console.log(_url);
    ...
```
을 추가하고, 코드 저장하고 나서  
cmd에 프로젝트 폴더 들어가서 node main.js 실행하고  
웹페이지 열어서 htt<area>p://localhost:3000/?id=HTML 처럼 뒤에 쿼리스트링 추가해서 접근하도록 해보자.  

그러면  
cmd상에서 다음과 같은 메세지가 나온다  

![image](https://user-images.githubusercontent.com/101965836/159620993-6a7c2b5d-1bc9-4af4-b6f4-510f90403d1a.png)

***/?id=HTML***  
이라는 메세지를 볼 수 있다  
  
즉  
request.url은  
앞에 주소+포트인 localhost:3000을 제외한  
/... 내용이 들어온다.  

---

자 그러면    
위의 _url 값을 추출함을 통해서  
원하는 데이터를 얻어보다  

parse : url을 분석한다 는 뜻  

nodejs url parse query string 검색  
[참고한 글](https://stackoverflow.com/questions/8590042/parsing-query-string-in-node-js)  
코드에 다음과 같은 내용을 추가했다  

```
...
var url = require('url');

var app = http.createServer(function(request,response){
    ...
    var queryData = url.parse(_url, true).query;
    console.log(queryData);
    ...
    response.end(fs.readFileSync(__dirname + _url));
});
...
```
  
- ### 아직 잘 모르겠지만, url.parse(...)는 다음과 같은 뜻이라 한다  
`
url.parse(String, (boolean), (boolean))는 파싱될 주소 URLString을 첫 번째 인자로 받고, 그 다음에는 parseQueryString이라고 하는 매개 변수를 받아서 URL object를 반환합니다.
`  
  
   
아무튼 코드 저장하고 나서  
cmd에 프로젝트 폴더 들어가서 node main.js 실행하고  
웹페이지 열어서 htt<area>p://localhost:3000/?id=HTML 처럼 뒤에 쿼리스트링 추가해서 접근하도록 해보자.  
  
  
![image](https://user-images.githubusercontent.com/101965836/159623577-9190945d-76de-4fc6-8bca-d076bc967f13.png)
  
그러면 console.log(queryData)로 queryData가 어떤식인지 볼 수 있고  
주목할 부분은 뒤에 { id: 'HTML' } 이다.
이건 쿼리데이터에 담겨있는 객체 라는 뜻인데 객체는 나중에 알아본다.  
  
다시  
```
    console.log(queryData.id)
```
로 .id를 추가하면  
  
![image](https://user-images.githubusercontent.com/101965836/159624090-2dd8232e-1d1f-4263-8eee-e515fad25fa7.png)
  
  
id만 딱 뜬다.

이번 강의를 통해서 쿼리 스트링을 어떻게 얻어내는지 알아냈다.  
여기다가 덧붙여서  
```
    response.end(fs.readFileSync(__dirname + _url));
```
이 부분을
```
    response.end(fs.readFileSync(queryData.id);
```
라고 수정 하고,  
다시 node main.js 켜고  
htt<area>p://localhost:3000/?id=HTML  
로 접속해보자  
  
그러면 아래 이미지와 같이 뜬다.

![image](https://user-images.githubusercontent.com/101965836/159624437-2d0c8490-1552-46ba-93d7-3b4ab3c28d08.png)
  
즉 response.end(...) 내용은  
클라이언트에게 어떤 메세지를 보여줄지 나타내는 코드고  
기존에는 
```
    response.end(fs.readFileSync(__dirname + _url));
```
라고 적혀있었으니, 이건 대충 url에 따라서 어떤 파일을 보여줄거다(ex. 1.html 파일 보여줄거다)  
라는 식으로 동작했던 것임을 알 수 있다.  
  
    
바꾼 response.end()는  
쿼리스트링의 id만 떡하니 출력 해주는거니까  
저렇게 /?id=HTML 로 접속하게 되면  
HTML만 뜨게 되는거고  

앞으로는 이제  
쿼리스트링에 따라서 판단하고 적절한 HTML 문서를 보여주는 형식으로 공부해 나갈 것 같다  
  
    
      
      
11.쿼리스트링에 따라 완성된 웹페이지 출력
===

앞선 강의에서
```
var queryData = url.parse(_url, true).query;
```
를 통해서 쿼리 스트링을 얻고
```
var title = queryData.id;
```
를 통해서 *?id=HTML* 로 접속한다면 뒤에 있는 HTML만 추출해서 title 변수에 저장할 수 있음을 알게 됐다.  
  
  
---
# 이번 강의에서는
쿼리 스트링(예제에선 id값)에 따라서 페이지가 동적으로 바뀌도록 해보겠다  
  
  
  
일단 1.html 파일로 부터 본문을 가져오고
var template = ` (본문) ` 
이처럼 template 변수에다가 1.html 내용을 저장한다음

요청에 따라 페이지를 전달하는 코드인 response.end()에다가
response.end(template) 라고 적어 놓아서, template에 적힌 html 코드를 전송하도록 했다.  
  
또한, 쿼리 스트링에 따라서 타이틀과 h2 부분을 바뀌도록 하고 싶으므로
아래와 같이 수정했다
  
---
```
    <title>WEB1 - HTML</title>
    ...
    <h2>HTML</h2>
```
같은 부분들은 쿼리 스트링의 id값이 HTML -> CSS -> JavaScript등으로 바뀌면  
이에 따라서 동적으로 바뀌었으면 좋겠다  
따라서 이걸 다음과 같이 변경했다  
  
```
    var title = queryData.id;
    ...
    <title>WEB1 - ${title}</title>
    ...
    <h2>${title}</h2>
```



<details>
<summary>상세 코드</summary>
<div markdown="1">
    
    var http = require('http');
    var fs = require('fs');
    var url = require('url');

    var app = http.createServer(function(request,response){
        var _url = request.url;
        var queryData = url.parse(_url, true).query;
        var title = queryData.id;

        if(_url == '/'){
          title = 'Welcome';
        }
        if(_url == '/favicon.ico'){
            response.writeHead(404);
            response.end();
            return;
        }
        response.writeHead(200);
        var template = `
        <!doctype html>
        <html>
        <head>
          <title>WEB1 - ${title}</title>
          <meta charset="utf-8">
        </head>
        <body>
          <h1><a href="/">WEB</a></h1>
          <ul>
            <li><a href="/?id=HTML">HTML</a></li>
            <li><a href="/?id=CSS">CSS</a></li>
            <li><a href="/?id=JavaScript">JavaScript</a></li>
          </ul>
          <h2>${title}</h2>
          <p><a href="https://www.w3.org/TR/html5/" target="_blank" title="html5 speicification">Hypertext Markup Language (HTML)</a> is the standard markup language for <strong>creating <u>web</u> pages</strong> and web applications.Web browsers receive HTML documents from a web server or from local storage and render them into multimedia web pages. HTML describes the structure of a web page semantically and originally included cues for the appearance of the document.
          <img src="coding.jpg" width="100%">
          </p><p style="margin-top:45px;">HTML elements are the building blocks of HTML pages. With HTML constructs, images and other objects, such as interactive forms, may be embedded into the rendered page. It provides a means to create structured documents by denoting structural semantics for text such as headings, paragraphs, lists, links, quotes and other items. HTML elements are delineated by tags, written using angle brackets.
          </p>
        </body>
        </html>
        `;

        response.end(template);

    });
    app.listen(3000);
</div>
</details>
  
---

그런데 여기서  
HTML이면 HTML에 맞는 본문이
CSS면 CSS에 맞는 본문이 나오도록 하고 싶다  
  
이걸 위해서 다음 시간에는  
본문 내용만 따로 파일로 저장해서 출력하도록 할 것이다


12.Node.js파일 다루기
===

# CRUD  
create  
read  
update  
delete  
  
파일이건 데이터베이스건 어떻게 생성하고 읽어야 하는지 알아야 한다  
그리고 수정하고 삭제할 수 있어야 한다  
이를 가장 중심적으로 보고  
이번 시간에는 FILE을 어떻게 nodejs로 읽을 수 있는가를 보고  
차후 CRUD의 UD도 볼 것이다  

---

# 파일 읽는법

![image](https://user-images.githubusercontent.com/101965836/159636076-45fa8d1d-7f21-4194-94e4-63f92a5fcba8.png)  
nodejs 폴더 만들고, 아무 내용이나 넣은 sample.txt 파일 만들고  
fileread.js는 아래 상세코드와 같이 입력했다.  
  
<details>
<summary>fileread.js 상세 코드</summary>
<div markdown="1">
    var fs = require('fs');
    fs.readFile('sample.txt', 'utf-8', function(err, data){
        console.log(data);
    });
</div>
</details>  
  
![image](https://user-images.githubusercontent.com/101965836/159636183-8c62cd1c-64d7-4072-ad6b-a061580ec40b.png)  
그러면 이렇게 나온다  
  
정말 간단하게 원리 설명 없이 파일 읽기만 해봤다  
  
  
13.쿼리스트링에 따라서 본문이 변경되는 App제작
===

<details>
    <summary>main.js 수정 코드</summary>
    <div markdown="1">
        fs.readFile(`data/${title}`, 'utf-8', function(err, description){
      var template = `
      <!doctype html>
      <html>
      <head>
        <title>WEB1 - ${title}</title>
        <meta charset="utf-8">
      </head>
      <body>
        <h1><a href="/">WEB</a></h1>
        <ul>
          <li><a href="/?id=HTML">HTML</a></li>
          <li><a href="/?id=CSS">CSS</a></li>
          <li><a href="/?id=JavaScript">JavaScript</a></li>
        </ul>
        <h2>${title}</h2>
        <p>${description}</p>
      </body>
      </html>
      `;
      response.end(template);
    });
    </div>
</details>  
  
쿼리스트링 id 따라서  
data/${title} 경로에 있는 파일(본문내용이 들어있는) 읽고  
이를 function(err, description){...} 처럼 해서, description 변수에다가 본문 내용 저장한 다음  
밑에 var template = `... ` 에서  
<p>${description}</p> 라고 적어서  
들어온 본문에 따라서 동적으로 바뀌도록 template 변수를 만들어 내고  
  
끝에 response.end(template);로 동적으로 바뀐 html을 전송해준다.  



14,15,16,17.JS문법-Boolean,비교연산자,제어문,조건문
===
![image](https://user-images.githubusercontent.com/101965836/159638336-430719be-2106-4e3c-82f9-20ef03746da3.png)  
이렇게 3가지 알아볼것이다  


# 15강 비교연산자
==와 ===의 차이점?

==는 Equal Operator이고,  ===는 Strict Equal Operator이다. 
==는 a == b 라고 할때, a와 b의 값이 같은지를 비교해서, 같으면 true, 다르면 false라고 한다.(값만 같으면 true이다.)

===는 Strict, 즉 엄격한 Equal Operator로써, "엄격하게" 같음을 비교할 때 사용하는 연산자이다. 
===는 a === b 라고 할때, 값과 값의 종류(Data Type)가 모두 같은지를 비교해서, 같으면 true, 다르면 false라고 한다. 



## 예시 1
```
var a = 1; 
var b = "1"; 
console.log(a == b); // true 
console.log(a === b); // false 
```  
  a와 b의 값은 둘 다 1이므로 ==로 쓰면 true가 된다
  그러나 a와 b는 각각 int와 string으로 Data Type이 다르기 때문에 ===는 false가 된다. 
  
## 예시 2
```
var a = [1,2,3]; 
var b = [1,2,3]; 
console.log(a == b); // false 
console.log(a === b); // false 
```  
  배열a b는 각각 ***주소가*** 저장된다  
  따라서 a와 b는 주소가 다르기 때문에 ==나 === 둘 다 false가 나온다
  
## 예시 3
```
console.log(true == 1); // true 
console.log(true === 1); // false 
```  
  1은 true를 뜻하고, 0은 false를 뜻할 수 있다.
  하지만 Data Type은 엄밀하게(strict)는 다르기 때문에
  false가 나오게 된다.
  
  
# 16강 제어문
# 17강 조건문
conditional statement

```
    if(){
        ...
    } else {
        ...
    }
```  
  
---
전체적으로 14 15 16 17 강에서는 기본 문법만 배움 (==랑 === 차이 빼고)

---  
  
    
18.콘솔에서의 입력값
===
18강의 내용은 실용적이기 보다는 그냥 if문 보여주는 기초 문법 강의다
```
var args = process.argv;
console.log(args[2]);
if(args[2] === '1'){
    console.log(" args[2] === '1' : TRUE ");
} else {
    console.log(" args[2] === '1' : FALSE ");
}
console.log('END')
```
![image](https://user-images.githubusercontent.com/101965836/159642814-d005258c-83e3-4602-bdef-b2d836b020eb.png)  
간단히 콘솔창에서 arg 값 준걸 바탕으로 조건문 만들어 봤다


19-1.App제작-notfound구현 19-2. 홈페이지 구현
===
  
  # 19-1.Notfound
  
앞선 예제 코드를 좀 수정하고 시작한다.
<details>
    <summary>코드 보기</summary>
          
    var http = require('http');
    var fs = require('fs');
    var url = require('url');

    var app = http.createServer(function(request,response){
        var _url = request.url;
        var queryData = url.parse(_url, true).query;
        var title = queryData.id;


        fs.readFile(`data/${title}`, 'utf-8', function(err, description){
          var template = `
          <!doctype html>
          <html>
          <head>
            <title>WEB1 - ${title}</title>
            <meta charset="utf-8">
          </head>
          <body>
            <h1><a href="/">WEB</a></h1>
            <ul>
              <li><a href="/?id=HTML">HTML</a></li>
              <li><a href="/?id=CSS">CSS</a></li>
              <li><a href="/?id=JavaScript">JavaScript</a></li>
            </ul>
            <h2>${title}</h2>
            <p>${description}</p>
          </body>
          </html>
          `;
          response.writeHead(200);
          response.end(template);
        });
    });
    app.listen(3000);  

</details>  
  
---  
  
이번에 할 것은 사용자가 잘못된 경로로 접근하면 Not Found를 출력하는 페이지를 만들 것이다.  
먼저 console.log(url.parse(_url, true)); 를 추가해서  
어떤 값을 볼 수 있는지 찍어보자  

![image](https://user-images.githubusercontent.com/101965836/159643920-2ed0d2f1-9997-4653-99aa-1ff61595f64a.png)  

이렇게 값이 나오는 것을 볼 수 있다.  
따라서 위 이미지에서 pathname만 얻고 싶으면 url.parse(_url, true).pathname 이라고 적으면 된다.  
  
  
---  
  
이제 pathname이 '/'인 경우에만 페이지를 정상적으로 표시하고,  
아닌 경우에는 에러를 표시하도록 해보자.  
<details>
    <summary>코드 보기</summary>  
      
    var app = http.createServer(function(request,response){
        var _url = request.url;
        var queryData = url.parse(_url, true).query;
        var pathname = url.parse(_url, true).pathname;
        var title = queryData.id;

        if(pathname === '/'){
          fs.readFile(`data/${title}`, 'utf-8', function(err, description){
            var template = `
            <!doctype html>
            <html>
            <head>
              <title>WEB1 - ${title}</title>
              <meta charset="utf-8">
            </head>
            <body>
              <h1><a href="/">WEB</a></h1>
              <ul>
                <li><a href="/?id=HTML">HTML</a></li>
                <li><a href="/?id=CSS">CSS</a></li>
                <li><a href="/?id=JavaScript">JavaScript</a></li>
              </ul>
              <h2>${title}</h2>
              <p>${description}</p>
            </body>
            </html>
            `;
            response.writeHead(200);
            response.end(template);
          });
        } else {
          response.writeHead(404);
          response.end('Not found');
        }

    });


</details>  
  
![image](https://user-images.githubusercontent.com/101965836/159644658-7a46cf73-fa38-4d7e-b15a-a2739f675a58.png)  
  이렇게 잘못된 경로로 접근하면 not found가 뜨게 된다.  
  
  ---  
  
  # 19-2.홈페이지구현  
  
  ![image](https://user-images.githubusercontent.com/101965836/159645435-4233b35a-3042-4cf9-bc97-9fc6d0e905fc.png)  
  처음에 접근하면 이렇게 undefined가 뜬다.  
  이걸 이제 적절한 Welcome 메세지가 들어있는 페이지로 띄울 것이다  
    
  처음 들어왔으니 pathname === '/' 이고, queryData.id === undefined 일 것이다  
  따라서 조건문을 적어보면  
  ```
  if(pathname === '/'){
    if(queryData.id === undefined){
        ...
    }
  }
  ```  
  이렇게 될 것이다.  
  
<details>
    <summary>코드 보기</summary>  
      
        var http = require('http');
        var fs = require('fs');
        var url = require('url');

        var app = http.createServer(function(request,response){
            var _url = request.url;
            var queryData = url.parse(_url, true).query;
            var pathname = url.parse(_url, true).pathname;

            if(pathname === '/'){
              if(queryData.id === undefined){
                fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description){
                  var title = 'Welcome';
                  var description = 'Hello, Node.js';
                  var template = `
                  <!doctype html>
                  <html>
                  <head>
                    <title>WEB1 - ${title}</title>
                    <meta charset="utf-8">
                  </head>
                  <body>
                    <h1><a href="/">WEB</a></h1>
                    <ul>
                      <li><a href="/?id=HTML">HTML</a></li>
                      <li><a href="/?id=CSS">CSS</a></li>
                      <li><a href="/?id=JavaScript">JavaScript</a></li>
                    </ul>
                    <h2>${title}</h2>
                    <p>${description}</p>
                  </body>
                  </html>
                  `;
                  response.writeHead(200);
                  response.end(template);
                });
              } else {
                fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description){
                  var title = queryData.id;
                  var template = `
                  <!doctype html>
                  <html>
                  <head>
                    <title>WEB1 - ${title}</title>
                    <meta charset="utf-8">
                  </head>
                  <body>
                    <h1><a href="/">WEB</a></h1>
                    <ul>
                      <li><a href="/?id=HTML">HTML</a></li>
                      <li><a href="/?id=CSS">CSS</a></li>
                      <li><a href="/?id=JavaScript">JavaScript</a></li>
                    </ul>
                    <h2>${title}</h2>
                    <p>${description}</p>
                  </body>
                  </html>
                  `;
                  response.writeHead(200);
                  response.end(template);
                });
              }
            } else {
              response.writeHead(404);
              response.end('Not found');
            }

        });
        app.listen(3000);  
      
  
</details>  
  
  
  ![image](https://user-images.githubusercontent.com/101965836/159646862-a6f41078-e938-4b6c-b227-ad81950e82bc.png)  
  여기 노란박스 부분들은 필요 없는 부분들이다.  
  알아서 지워주면 된다.  
  
  
20, 21, 22. js문법 - 반복문, 배열, 배열과 반복문
===
if () {} 형식인 것 처럼  
  
반복문도  
while () {}  
for () {}  
형식이다  
  
---  
배열에 값을 추가하려면 push를 쓴다  
```  
var arr = ['A', 'B', 'C', 'D'];
arr.push('E');
console.log(arr[4]);
  
> E
```  
  
---  
  
  
23.Node.js에서 파일목록 알아내기
===  
  
# 문제인식  
  
```
    <ul>
      <li><a href="/?id=HTML">HTML</a></li>
      <li><a href="/?id=CSS">CSS</a></li>
      <li><a href="/?id=JavaScript">JavaScript</a></li>
    </ul>
```  
  
이 부분. 데이터를 새로 추가 한다면 
추가 할 때마다 또 \<li> ... 해서 적어넣어줘야한다.  
게다가 분기가 하나 더 생겨서 저거랑 똑같은 부분이 다른곳에서도 반복이 된다면  
엄청 귀찮은 일이 될 것이다.

따라서 저걸 자동으로 만든다.

# 뭐가 들어오면 어떤걸 할거냐  
  
1. Data 폴더에 새 파일이 들어온다
2. main에서 자동으로 인식해서 해당 내용 자동으로 추가

## 이렇게

![image](https://user-images.githubusercontent.com/101965836/159654212-c9628594-bca2-4535-8419-a77ae270b5ad.png)  
![image](https://user-images.githubusercontent.com/101965836/159654098-c559a21d-6f81-46c2-9c75-6cbdc23212cb.png)  
  
추가 전 data 폴더에 3개(HTML CSS JavaScript)의 본문 파일만 존재한다  
  
![image](https://user-images.githubusercontent.com/101965836/159654168-18088963-1f48-4a7a-8110-c43aa233f098.png)  
![image](https://user-images.githubusercontent.com/101965836/159657039-adbe2c59-975a-472a-a8fe-1a69ac763f3d.png)  
  
추가 후 data 폴더에 3+1개(HTML CSS JavaScript Nodejs)의 파일이 저장되고,  
***자동으로*** 코드가 작동해서 웹페이지에 새로 들어온 Nodejs가 목록에 추가된다
  
  
---
  
  
data 디렉토리에 파일의 추가나 삭제가 이뤄지면 어떻게 자동으로 알아낼지 방법을 찾아야 한다  

[참고한 글](https://stackoverflow.com/questions/2727167/how-do-you-get-a-list-of-the-names-of-all-files-present-in-a-directory-in-node-j)  
  
  여기서 적절히 코드를 얻고,  
  nodejs/readdir.js 파일을 생성해 아래 코드를 입력하고 저장.
  
<details>
    <summary>코드 내용</summary>
    
    const testFolder = './data';
    const fs = require('fs');

    fs.readdir(testFolder, function(err, filelist){
        console.log(filelist);
    })
</details>
  
  여기서 testFolder = './data';에서 ./ 는 현재 디렉토리를 말한다. data폴더의 파일을 읽을것이니 ./data 가 된다.  
  일단 filelist가 어떻게 되는지 보기 위해서 console.log로 보면 아래와 같다  
  ![image](https://user-images.githubusercontent.com/101965836/159651464-230f9403-629a-45ce-b596-809a6280bef0.png)  
  
  [ 'CSS', 'HTML', 'JavaScript' ]
  즉, 파일리스트 형식은 배열로, 특정 디렉토리 파일 목록을 배열로 만들어서 전달한다.  
  
  
---

<details>
    <summary>수정한 부분 코드 보기 (main.js)</summary>
      
      
    ...  
      
    if(pathname === '/'){
      if(queryData.id === undefined){

        fs.readdir('./data', function(error, filelist){
          var title = 'Welcome';
          var description = 'Hello, Node.js';
          var list = '<ul>';
          var i = 0;
          while(i < filelist.length){
            list = list + `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
            i = i+1;
          }
          list = list+'</ul>';

          var template = `
          <!doctype html>
          <html>
          <head>
            <title>WEB1 - ${title}</title>
            <meta charset="utf-8">
          </head>
          <body>
            <h1><a href="/">WEB</a></h1>
            ${list}
            <h2>${title}</h2>
            <p>${description}</p>
          </body>
          </html>
          `;
          response.writeHead(200);
          response.end(template);
        })
      } else {
        fs.readdir('./data', function(error, filelist){
          var title = 'Welcome';
          var description = 'Hello, Node.js';
          var list = '<ul>';
          var i = 0;
          while(i < filelist.length){
            list = list + `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
            i = i+1;
          }
          list = list+'</ul>';

          fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description){
            var title = queryData.id;
            var template = `
            <!doctype html>
            <html>
            <head>
              <title>WEB1 - ${title}</title>
              <meta charset="utf-8">
            </head>
            <body>
              <h1><a href="/">WEB</a></h1>
              ${list}
              <h2>${title}</h2>
              <p>${description}</p>
            </body>
            </html>
            `;
            response.writeHead(200);
            response.end(template);
          })
        })
      }
    }  
      
    ...  
      
      
</details>


## 핵심 해설

```
        fs.readdir('./data', function(error, filelist){
          ...
          var list = '<ul>';
          var i = 0;
          while(i < filelist.length){
            list = list + `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
            i = i+1;
          }
          list = list+'</ul>';
```  
  
data 폴더에서 파일 리스트 읽고 filelist에 배열 형태로 저장된다.  
  
그다음 list 라는 변수에 차근차근 문자열을 쌓아 나가면서  
```
    <ul>
      <li><a href="/?id=HTML">HTML</a></li>
      <li><a href="/?id=CSS">CSS</a></li>
      <li><a href="/?id=JavaScript">JavaScript</a></li>
    </ul>
```  
이런 모양으로 코드를 완성해 나갈 것이다    
  
일단 제일 처음에 <<area>ul>로 시작하니까 var list = '<<area>ul>'; 이라고 선언과 함께 할당했고  
while 반복문을 통해서 data 폴더의 파일 이름들로 HTML CSS JavaScript 라고 들어가는 부분들을 자동으로 채워 넣는다.  
이렇게 해서 한번의 반복이 시행될 때 마다
```
...
<li><a href="/?id=[파일이름]">[파일이름]</a></li>
...
```
이런식으로 list 변수에 차곡차고 쌓이고,  
반복문 끝나면 list에 <<area>/ul>을 또 추가해서 최종적으로 코드를 닫아준다.  
  
  
  
  
그다음 아래에 본격적으로 해당 페이지의 전체 HTML을 만드는 template 부분에서
```
<body>
    <h1><a href="/">WEB</a></h1>
    ${list}
    <h2>${title}</h2>
    <p>${description}</p>
</body>
```    
라고 ${list}를 추가해주면, 우리가 쌓아올린 list 변수의 코드가 쫙 삽입이 된다.  
  
그리고 [메인 홈페이지]와 [내용 페이지]가 if(queryData.id === undefined)로 분기되어 있으므로  
둘 다 적절히 이 작업을 해줘서 위의 전체 코드처럼 해준다.  
  
  
---
  
이렇게 해서 자동으로 파일 목록을 알아내고,  
파일 이름에 따라서 목록에 해당 파일 제목과 내용이 자동으로 추가가 되도록 하는 방법을 알아봤다  
  
---
  
    
    
26.함수로 정리 정돈
===

```
    var template = `
          <!doctype html>
          <html>
          <head>
            <title>WEB1 - ${title}</title>
            <meta charset="utf-8">
          </head>
          <body>
            <h1><a href="/">WEB</a></h1>
            ${list}
            <h2>${title}</h2>
            <p>${description}</p>
          </body>
          </html>
          `;
```
이 코드는 [메인 홈페이지]와 [내용 페이지]반복되는 코드이기 때문에  
함수로 정리할 수 있다
   
정리한 코드는 다음과 같다  
<details>
    <summary> 코드 내용 </summary>  
          
        var http = require('http');
        var fs = require('fs');
        var url = require('url');

        function makeTemplate (title, list, description){
          var content = `
          <!doctype html>
          <html>
          <head>
            <title>WEB1 - ${title}</title>
            <meta charset="utf-8">
          </head>
          <body>
            <h1><a href="/">WEB</a></h1>
            ${list}
            <h2>${title}</h2>
            <p>${description}</p>
          </body>
          </html>
          `;
          return content;
        }

        function makeList (filelist){
            var list = `<ul>`;
            var i = 0;
            while(i < filelist.length){
              list = list + `<li><a href="/?id=${filelist[i]}">${filelist[i]}</a></li>`;
              i = i+1;
            };
            list = list+'</ul>';
            return list;
          }

        var app = http.createServer(function(request,response){
          var _url = request.url;
          var queryData = url.parse(_url, true).query;
          var pathname = url.parse(_url, true).pathname;

          if(pathname === '/'){
            if(queryData.id === undefined){
              fs.readdir('./data', function(error, filelist){
              var title = 'Welcome';
              var description = 'Hello, Node.js';

              var list = makeList(filelist);
              var template = makeTemplate(title,list,description);
              response.writeHead(200);
              response.end(template);
              })
            }
            else {
              fs.readdir('./data', function(error, filelist){
                fs.readFile(`data/${queryData.id}`, 'utf-8', function(err, description){
                  var title = queryData.id;
                  var list = makeList(filelist);
                  var template = makeTemplate(title,list,description);

                  response.writeHead(200);
                  response.end(template);
                })
              })  
            }
          } 
          else {
            response.writeHead(404);
            response.end('Not found');
          }
        });
        app.listen(3000);  
</details>

여기서 주의할 점은 fs.readdir이 비동기처리라는 점이다
간략히, 비동기처리란  
```
funcA(){...}  
funcB(){...}  
```  
라고 한다면  
당연히 동기, 비동기 개념이 없으면  
funcA가 끝나면 funcB가 시작된다고 생각할 수 있다.  
  
하지만 두 함수가 비동기 처리일 경우
funcA가 시작되고 처리되는 중에, funcB가 시작된다.  
따라서 funcA funcB중 뭐가 먼저 끝날지 알 수 없고, 이를 해결하기 위해서는
```
funcA(){
    funcB(){
        ...
    }
}
```  
이렇게 생긴 지옥으로 빠지게된다.
  
---
  
### 콜백지옥
![image](https://user-images.githubusercontent.com/101965836/159686863-d049aa78-d631-49fa-a24e-7f3249121225.png)  

---

따라서 이를 해결하기 위해  
callback에 대해 배운 후, promise / async await  
에 대해서 배워야 한다.  
일단은 생활코딩 강좌 진도를 위해 그런게 있다 정도만 알고 뒤에서 배워두자.  

[1. Callback](https://www.daleseo.com/js-async-callback/)  
[2. Promise](https://www.daleseo.com/js-async-promise/)  
[3. async/await](https://www.daleseo.com/js-async-async-await/)  
  
  
