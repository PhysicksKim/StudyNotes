# 10. 날짜와 시간 & 형식화  

## 10-1~3 날짜와 시간, Calendar 클래스  

### java.util.Date 
날짜와 시간을 다룰 목적으로 만들어진 클래스 (JDK1.0;1995년)  
근데 Date 메서드는 거의 deprecated이지만, 여전히 쓰이고 있긴 하다  

### java.util.Calendar  
Date 클래스를 개선한 새로운 클래스(JDK1.1;1997년)   
그러나 여전히 단점이 존재  

### java.time패키지  
Date와 Calendar의 단점이었던 날짜와 시간을 같이 다뤄야 하는 단점을 개선해 새로운 클래스들을 제공한다 (JDK1.8)   
이외에도 몇 가지 단점들을 보완했고, 될 수 있으면 time 패키지를 쓰는게 좋다    
하지만 레거시들이 여전히 쓰이고 있으니 Date와 Calendar도 알아둬야 한다   
  
  
### 이걸 왜 배워야 하는가?    
날짜와 시간은 굉장히 중요하다. 실제로 비즈니스 구현에 날짜와 시간은 굉장히 중요하게 다뤄진다. 따라서 날짜와 시간을 어떻게 다뤄야 하는지에 대해서 배워야 한다.  
  
### Calendar 클래스
추상 클래스이므로 getInstance()를 통해 구현된 객체를 얻어야 한다.  
```
Calendar cal = new Calendar(); // 에러! 추상클래스는 인스턴스를 생성할 수 없다
```
```
Calendar cal = Calendar.getInstance(); // OK! getInstance()메서드는 Calendar클래스를 구현한 클래스의 인스턴스를 반환한다.
```

### 예제 
```java
Calendar today = Calendar.getInstance();
// today.get() 안에는 int형으로 숫자를 입력받는다. 1을 주면 YEAR, 2를 주면 MONTH, 3을 주면 WEEK_OF_YEAR을 반환한다.
// 약간 뇌피셜로 Switch CASE 구문으로 CASE 1 CASE 2 같은 식으로 있나보다.  
// 그래서 today.get(1); 이런식으로 할 순 없으니, Calendar 클래스 내부에 static으로 선언된
// Calendar.YEAR 같은 static 상수값을 줘서 값을 갖고온다
System.out.println("올해는... " + today.get(Calendar.YEAR));
System.out.println("오늘이 몇 월이냐면... " + (today.get(Calendar.MONTH)+1));
System.out.println("오늘은 올해의 몇째 주냐면... " + today.get(Calendar.WEEK_OF_YEAR));
```  

## 10-4,5 Calendar 클래스 예제 - set() 메서드 사용

### set()으로 날짜와 시간 지정
```
void set(int field, int value)
void set(int year, int month, int date)
void set(int year, int month, int date, int houfOfDay, int minute)
void set(int year, int month, int date, int hourOfDay, int minute, int second)
```

### 날짜 지정하는 방법
**월(Month)이 0~11** 임에 주의  
```java
Calendar date1 = Calendar.getInstance();
date1.set(2022, 4, 1); // 2022년 5월 1일 (4월이 아니라 5월임)
```
```java
// 이렇게도 가능
date1.set(Calendar.YEAR, 2022);
date1.set(Calendar.MONTH, 4);
date1.set(Calendar.DATE, 1);
```

### 시간 지정하는 방법
시간을 지정하는 방법은 따로 없어서 일일이 해줘야함  
```java
Calendar time1 = Calendar.getInstance();
time1.set(Calendar.HOUR_OF_DAY, 10);
time1.set(Calendar.MINUTE, 20);
time1.set(Calendar.SECOND, 30);
```
### clear() 
옛날에 "이거 날짜를 언제를 기준으로 할건가?" 라는 논의에서    
그냥 "1970-01-01T00:00:00"을 기준으로 하자  
라고 결론지었다.  
그냥 컴퓨터가 나오기 전에 대충 적당한 날짜로 정한 것이다  
그래서 .clear();로 초기화를 하면 1970년 1월 1일 00시 00분 00초로 초기화 된다.  
  
```
Calendar dt = Calendar.getInstance(); // 현재 시간
dt.clear(); // 초기화
System.out.println(new Date(dt.getTimeInMillis(); //
```

한편, clear(int field)를 하면 특정 필드를 초기화 한다.  
예를 들어 clear(Calendar.SECOND) 라고 하면 초를 초기화 하게 된다.  

### clear()의 용도 (예제10-5)  
예를 들어   
두 날짜 값을 인자로 받고, 두 날짜간 며칠 차이인지를 반환하는 메서드를 구현한다 해보자.  
그러면 Calendar 형식으로 2개의 인스턴스를 얻고  
여기다가 .set()해서 인자로 받은 날짜를 대입해서   
두 인스턴스를 .getTimeInMillis()로 빼주고, 다시 일(date) 단위로 변환하면 된다고 생각할 수 있다.  
  
하지만 이렇게 하면 문제가 발생하는데   
아래 코드를 보자  
```
static int getDayDiff(String yyyymmdd1, String yyyymmdd2) {
  ...
  try {
    ... // (인자로 받은 String을 분해해서 int형으로 year, month, day로 변환 
    
    Calendar date1 = Calendar.getInstance();
    Calendar date2 = Calendar.getInstance();
    date1.set(year1, month1, day1);
    date2.set(year2, month2, day2);
    ... // millisecond 단위로 get 해서 두 날짜 빼고 일(date)로 전환
  } catch ...
```

근데 이렇게 하면 date1과 date2가 딱 2일 차이라 하더라도  
1.999999.... 이런식으로 뜬다   
왜냐하면    
date1과 date2 가 생성되는 시간에서 약간의 millisecond 차이가 발생할 수 있기 때문이다  
따라서 이럴 때 아래와 같이 clear를 해주고 set해야 한다.  
```
Calendar date1 = Calendar.getInstance();
Calendar date2 = Calendar.getInstance();
date1.clear();
date2.clear();
date1.set(year1, month1, day1);
date2.set(year2, month2, day2);
```

## 10-6 add와 roll
add와 roll 둘 다 특정 필드의 값을 더해준다  
```
date.add(Calendar.DATE, 1); // 날짜(DATE)에 1을 더한다
date.add(Calendar.MONTH, -8); // 월(MONTH)에 8을 뺀다
```
  
#### 차이점  
add()는 **다른 필드에 영향O**    
roll()은 **다른 필드에 영향X**    
  
```
date.set(2020, 7, 31);

date.roll(Calendar.DATE, 1); // 2020년 7월 1일
date.roll(Calendar.MONTH, -8); // 2020년 1월 31일
```  
  
  
## 10-7 커맨드라인으로 달력 모양으로 출력하는 예제
특별한 내용은 없고, 그냥 필요하면 한 번 그때 보면 좋은 정도다  
대충 달력을 만들 때 어떻게 작성하면 좋을지 약간 노하우 스러운 예제다  

## 10-8 Date와 Calendar간의 변환  
Date의 메서드는 대부분 deprecated 되었지만 여전히 사용하기 때문에 변환 방법 정도는 알아두는 것이 좋다  

### Calendar -> Date
```
Calendar cal = Calendar.getInstance();  
...
Date d = new Date(cal.getTimeINMillis());
```

### Date -> Calendar
```
Date d = new Date();
...
Calendar cal = Calendar.getInstance();
cal.setTime(d);
```

## 10-9 형식화 클래스
#### 형식화 클래스란?  
java.text 패키지에 DecimalFormat, SimpleDateFormat이 있는데  
숫자나 날짜를 원하는 형식으로 쉽게 출력하도록 할 때 사용하는 클래스이다  
  
예를 들면 아래와 같이  
double형 숫자를 지수형으로 바꿔주고 싶으면  
아래와 같이 format을 사용할 수 있다.  
```
double number = 123456.789;
DecimalFormat df = new DecimalFormat("#.#E0");
String result = df.format(number);  // result = "1.2E6"
```
    
반대로 형식화된 숫자나 날짜에서 데이터를 편리하게 정제할 수 있다  
```
DecimalFormat df = new DecimalFormat("#,###.##");
Number num = df.parse("1,234,567,89");
double d = num.doubleValue(); // 1234567.89
```

## 10-10 DecimalFormat
숫자를 형식화할 때 사용한다  
이때 패턴을 어떻게 주는지는 굉장히 다양하다  
```
DecimalFormat df = new DecimalFormat("#.#E0");  
```
패턴에 관한 것은 자주 사용하는 패턴들은 알아두면 좋겠지만  
그냥 상황에 따라서 필요하면 그 때 검색해서 알아봐도 된다  

## 10-11,12 DecimalFormat에 관한 예제
대충 그냥 패턴을 어떻게 쓰는지 알려주는 간단한 예제다  

## 10-13~16 SimpleDateFormat
날짜와 시간을 다양한 형식으로 출력할 수 있게 해준다  
```
Date today = new Date();
SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd");

String result = df.format(today);
```

반대로 문자열에서 날짜와 시간을 간단히 뽑아낼 수도 있고,  
날짜 문자열을 다른 형식으로 바꾸는 것도 아래 예제와 같이 두 단계를 거치는 식으로 해서 가능하다  
```
DateFormat df = new SimpleDateFormat("yyyy년 MM월 dd일");
DateFormat df2 = new SimpleDateFormat("yyyy/MM/dd");

Date d = df.parse("2015년 11월 23일");
String result = df2. format(d);
```
