> 선행 지식 : 대칭키 및 비대칭키 암호화 원리   
   
# HTTPS 연결 과정   
   
![image](https://github.com/PhysicksKim/TIL/assets/101965836/c8ad853d-a4fd-4d0b-ac2e-2fd744c35db9)   
     
- 인증서 등록 과정 (1,2)   
서버는 공개키/비밀키 를 생성하고 공개키를 CA 에 등록한다.   
서버는 CA 에게 공개키를 전달해주고    
CA는 "서버의 공개키 + CA 개인키"로 인증서를 생성하여 서버에게 반환해준다.   
   
- 서버가 제공한 인증서 검증 (3,4,5)
(3) 클라이언트는 서버로 부터 인증서를 받는다     
(4) 클라이언트는 미리 신뢰할 수 있는 CA 기관들의 공개키를 저장해둔다. 저장해둔 공개키로 유효한 인증서인지 서명을 확인한다.  
(5) CA 공개키로 복호화하여 얻은 서버의 공개키를 클라이언트가 저장해둔다.  
  
- HTTPS 암호화를 위한 대칭키 교환 (6)  
클라이언트는 대칭키를 생성하고 서버의 공개키로 암호화 한 다음, 서버에게 암호화된 대칭키를 전달한다.  
서버는 개인키로 이를 복호화 하고 대칭키를 클라이언트별로 저장해둔다.  
  
- 이후 통신 과정에서 암호화  
서버와 클라이언트 둘 다,
클라이언트가 생성한 대칭키로 메세지를 암호화 한다.
서버는 클라이언트별로 HTTPS 연결 세션마다 대칭키를 저장해둔다.     
  
## 대칭키 사용 이유 - 빠르다  
매 요청마다 서버의 공개키로 암호화한 메세지를 제공한다면  
서버는 매 번 비밀키로 복호화 해야하는데  
대칭키의 암호화 복호화 비용보다, 비대칭키 암호화/복호화 비용이 훨씬 더 비싸다.    
따라서 최초 handshake 만 비대칭키를 사용하고  
이후 부터는 교환해둔 대칭키로 메세지를 암호화 복호화 한다.  
