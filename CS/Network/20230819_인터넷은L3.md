# 서론  
  
OSI와 네트워크를 처음 접하면  
네트워크의 근간이 "표준" 이라서  
표준을 항상 엄밀히 따라야 한다는 함정에 먼저 빠지고 시작한다.  
이게 무슨 말인지 서론으로 다룬다.  
  
<br>  
  
## 네트워크 공부할 때 OSI 7계층 암기부터 시작하지 말자  
내가 처음 네트워크 공부할 때   
    
> OSI 7계층 외워라. 면접에 나옴.   
    
이라고 해서 봤는데  
진짜 무슨소린지 하나도 와닿지 않았다.  
  
<br>  
   
이게 어쩌면 당연하다    
이제야 for문 배우는 코딩 입문자한테   
  
> 향상된 for문은 Iterable 인터페이스를 구현한 구현체에 대해서만 사용할 수 있어.
> 왜냐하면 해당 객체에서 Iterator 를 얻어낸 다음 for loop를 돌리는 방식이거든.
  
이라고 설명하면 알아들을 수가 있겠는가.  
인터페이스와 구현체가 뭔지도 모르는데  

이런 측면에서 OSI 7계층을 배우기 전에  
실제로 인터넷이 어떻게 동작하는지를 보고(구현체)    
그 다음 OSI 7계층에 대해 알아가는 게 맞다고 본다.  
  
근데 이를 동시에 설명하기도 하고  
또는 OSI 7계층을 먼저 설명하기도 하니까  
왜 계층을 그렇게 나눠야하지? 대체 계층 나누는 기준이 뭐지? 라는 생각이 들게된다.  
  
계층(인터페이스)을 나누는 기준은 대게  
재활용성, 중복, 분리   
같은 이유에서 온다.  
  
근데 네트워크 생전 처음보는데  
  
대체 어떻게   
  
> 이 부분에서 재활용성, 중복, 관심사 분리가 필요하겠구나
  
라고 캐치할 수 있겠는가.  

그래서 OSI 7계층 보다  
실제로 인터넷이 어떻게 동작하는지를 먼저 보는 게 중요하다.  

  
<br>  
  
## OSI = 인터페이스

인터페이스 = 표준  
표준으로 7계층을 정의했다고 해서  
인터넷(TCP/IP)이 꼭 7계층으로 이뤄져야 할 필요는 없다.  
  
인터페이스는 이론이다.  
"이론상 이런 구조가 좋습니다" 라고 했지만  
"근데 인터넷을 구현할때는 이거랑 이거는 꼭 계층을 분리할 필요가 없을 것 같아" 라고 될 수 있다.  
  
TCP/IP 4계층 말고 다른 예시를 보면  
Bluetooth 의 경우 엄밀한 OSI 계층을 따르지 않으며 조금 다르게 구성된다고 한다.  
  
따라서  
이 함정에 빠지지 말자.  
"Router 는 정확히 몇 계층인가요?"  
  
Router 가 L2 안에 있기도 하고  
L2 안에 Router 가 있을 수 있다.  
  
이게 무슨 말이냐면  
그냥 구현하기 따라 다른거다.  
어떤 Router 제품은 L2 수준의 동작만 할 수도 있는거고  
어떤 Router 제품은 L3 수준의 동작까지도 할 수 있는거다.  
  
그래서   
"이 기능은 정확히 L2 동작만 해!"  
"이 제품은 정확히 L1 + L2 동작만 해!"  
이렇게 OSI 계층에 딱 맞아떨어지게 실제 구현체가 이뤄져 있을거라는 환상부터 버리고 시작해야 한다.  
  
상황과 용도에 따라서 계층 구조가 변형될 수 있다.  
계층(=인터페이스)이란건 엄밀한 규칙으로 재단하고자 하는게 아니다.    
  
그래서 "OOO는 정확히 몇 계층임? 왜 L1 + L2임? 그거 L3도 포함된 거 아님?" 이라고 묻고 들어가면 끝도 없는 함정에 빠져든다는 점 부터 인지하고 들어가자.  
  
<br><br><br>

---

<br><br><br>  
   
# 인터넷은 L3 이고, Router 까지는 L2 이다  
  
### 오해  
처음에 내가 한 오해는 이렇다  
   
![image](https://github.com/PhysicksKim/TIL/assets/101965836/5527fba2-82c9-4662-bf58-5579ca2a5df5)  
   
> PC 벗어나면 OSI 계층 L7 - L6 - ... - L1 됐으니까  
> 그 다음 전선으로 신호가 오고가니까 전부 L1 아냐?  
> 근데 TCP/IP는 제일 밑에 계층이 L1 + L2 니까 최대 L2겠구만  
  
바보같을 수 있지만   
난 이렇게 오해했다   
  
<br>  
  
### 올바른 이해  
답부터 보자.   
  
![image](https://github.com/PhysicksKim/TIL/assets/101965836/a99ee023-5d79-4c48-8e6f-7f7beb430fbe)  
  
이렇게 된다.  
  
L2 사이에 L3가 끼여있다  
  
그러면 이 오해가 어디서 온걸까?  


### 오해의 원인 - 그냥 겉에 주소만 보는 거 아냐?  

![image](https://github.com/PhysicksKim/TIL/assets/101965836/4d1c146d-3af1-4f01-b879-e0e98c9d32d2)  
  
네트워크에서 택배로 비유를 많이 한다.  
그러면 보자.  
배송된 택배 상자(네트워크 패킷)겉에는 받는사람 주소만 적혀있다.  
옥천허브(중간 거점; 인터넷 망에 해당)에서 이 택배를 까보지 않고  
그냥 겉에 주소만 보고 넌 어디로 가 라는 것을 정한다.  
  
<br>

---

<br>  
    
![image](https://github.com/PhysicksKim/TIL/assets/101965836/5748a5ed-1ff5-40c7-a1dc-6f28158ecba3)
  
이 비유를 그대로 네트워크로 가져온다면 오해가 생긴다.  
  
패킷 겉에는 OSI 최하위 계층에 해당하는 주소가 있을거다.  
  
> 인터넷은 TCP/IP 4계층을 따르고, 최하위 계층이 OSI 기준 L1+L2 니까 "L1/L2 주소" 가 겉에 있겠네?    
> 그러면 신호가 날아가는 동안 패킷 겉면에는 L1/L2 주소가 붙어있으니
> 인터넷 망에서는 L1/L2 주소를 보고 목적지를 찾아가겠구나!
  
이렇게 해석하게 되는거다  
  
---
  
![image](https://github.com/PhysicksKim/TIL/assets/101965836/447c39b3-132f-4785-8921-172aa5979685)  
  
이렇게 오해한다.  
  
"택배도 겉에 주소만 보니까, 네트워크도 중간 기점에서 겉에 주소(L2 주소) 만 보겠네!"  
  
이게 문제였다.  
  
<br><br>  
  
---
  
<br><br>    
 
# 몰랐던 부분 : 거점마다 캡슐을 까본다  

간단하다. 거점마다 Decapsulation 하고 L3 주소(IP) 기준으로 식별한다  
    
> Encapsulation/Decapsulation(캡슐화/역캡슐화) 에 대해서 안다고 가정한다.  
  
![image](https://github.com/PhysicksKim/TIL/assets/101965836/1d565990-cc8b-4ede-94e9-3cfef4f27000)  

이렇게 인터넷 망에서는 L2 MAC 주소로 다음 행선지를 택하는 게 아니라  
하나 벗겨내서 안에 L3 IP 주소로 어디로 가야하는지를 식별한다.  
  
이게 전부다.  
  
그리고 인터넷 망에서 패킷이 전송되는 동안  
반복적으로 Encapsulation/Decapsulation 이 일어난다.  
  
<br><br>  

# 왜 로컬 네트워크는 MAC(L2) / 인터넷은 IP(L3) 인가?  
  
> 완전한 래퍼런스나 답변을 찾지 못했습니다.    
> 따라서 이 문단은 팩트 기반으로 한 뇌피셜 입니다.  
    
MAC 주소 / IP 주소를 둘 다 사용하는 이유는  
로컬 네트워크/인터넷 망을 분리하기 위해서다  
  
<br>    
  
인터넷은 전 세계를 아우르는 망이다.   
따라서 전 세계에서 유일한 주소가 필요하다.     
  
그런데 MAC 주소 하나만으로 유일한 지점을 식별하기에는 한계에 봉착했다.  
집집마다 인터넷 기기가 생기니 주소를 더이상 유일하게 만들 수 없게 된 것이다.    
  
그래서 전략을 바꿨다.  
   
- IP 주소 : 전 세계 인터넷 망에서 유일한 로컬 네트워크를 식별    
- MAC 주소 : 로컬 네트워크 내부에서 유일한 통신 기기를 식별  
  
즉, 로컬 네트워크 안에서는 MAC 주소를 쓰고  
전 세계 인터넷 망(WWW) 에서는 IP 주소를 쓰는 식으로 분리한 것이다.  
이게 MAC 주소 / IP 주소 둘 다 쓰는 이유다.  
  
<br>  
  
### 그러면 MAC L3 / IP L1 됐으면 되는 거 아냐?  
  
나도 그렇게 생각한다.  
MAC을 로컬 장치 식별에 쓰는 게 아니라  
WWW 에서 유일한 지점을 식별하는데 썼으면 되지 않았을까 싶었다.  
  
근데 이게 순서의 문제인 것 같다.  
  
> MAC 주소 정도면 2^48 = 약 281조 개 니까  
> 전세계 유일성 보장에 충분하겠지?
  
라고 생각했는데  
  
세상에 통신 기계가 너무 많이 생겼다.  
인터넷과 연결된 기계 뿐만 아니라 블루투스 통신도 MAC 주소를 기반으로 식별한다  
  
이러다보니 주소의 한계에 봉착했는데  
더한 문제는 이미 너무 많은 통신이 Endpoint 식별에 MAC을 쓰는거다.  
  
### 만약 MAC 주소를 L3로 올리거나, L1 아래에 L0 를 만들면 안되나?  
  
그러기에는 이미 너무 멀리 와버렸던 것이다.  
MAC을 L3로 올리기 / L1아래에 L0 만들기 에는 너무 많은 장치들과 표준 통신 규약이 생겼다.  
표준 규약을 깨려면 그만큼 노력이 더 들어간다.  
  
그래서 L1 L2 는 두고  
L3 계층에다가 새로운 내용인 IP 주소를 추가하자고 바뀐 것이다.  
  
