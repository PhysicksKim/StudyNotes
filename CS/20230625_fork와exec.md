# 글을 쓴 계기  

fork와 exec이 뭔지는 딱 알겠는데  
exec가 그냥 설명만 따로 놓고보면 "어? 이걸 어디다 써?" 싶은 부분이 있다.  
  
그래서 이걸 좀 더 제대로 실용적으로 이렇게 쓰인다 관점을 더해서 기록을 남긴다.   

<br><br>  

# 기본 fork와 exec 개념   
  
fork와 exec에 대해서는 검색을 통해 쉽게 알 수 있다.  
  
- fork : 프로세스를 통째로 복사함. PID만 딱 바뀜.
- exec : 프로세스 구분자(PID, PPID, CPID)는 그대로 두고, 내용을 싹 다 바꾼다.
  
<br><br>  

# fork, exec 를 따로 보면 이상하다  
  
- fork  
fork로 프로세스를 복사해서 뭐하지?    
Excel을 2개 띄워야 할 때 써야하나?    

- exec  
Excel 프로세스를 잘 실행하다가    
갑자기 Excel 프로세스를 lol 같은 게임 프로세스로 바꿀 일이 있겠는가?    
당연히 아니다.  
그럼 exec를 쓰는 이유는 뭐지?
  
<br><br>  
  
# 프로세스를 완전히 새로 실행하는 건 오래 걸린다  
  
프로그램 파일은 HDD에 있기 때문에  
이를 Memory로 불러오려면 속도 차이가 많이 나니까  
상대적으로 오래 걸린다.  
  
또한 프로세스를 구성하기 위한 Header 들을 해석하고 메모리에 자리를 마련하는 등 작업이 있어야 해서  
이리저리 프로세스를 하나 새로 띄우는 작업이 적지않은 자원과 연산을 소모하는 일이다.  
  
<br><br>  
  
# 그래서 가능하면 fork로 복사가 좋다  
  
새로 프로세스를 띄우려면 프로그램을 HDD에서 가져와야 한다.   
반면 이미 실행중인 process 는 Memory에 있다.  
그러므로 실행중인 process 를 복사하는게   
Memory -> Memory 로 이동하는 것이므로  
훨씬 더 빠르다.  
  
<br><br>  
  
# 그리고 fork와 exec를 조합해서, 새 프로세스를 띄울 수 있다  

```
+--------+
| pid=7  |
| ppid=4 |
| bash   |
+--------+
    |
    | calls fork
    V
+--------+             +--------+
| pid=7  |    forks    | pid=22 |
| ppid=4 | ----------> | ppid=7 |
| bash   |             | bash   |
+--------+             +--------+
    |                      |
    | waits for pid 22     | calls exec to run ls
    |                      V
    |                  +--------+
    |                  | pid=22 |
    |                  | ppid=7 |
    |                  | ls     |
    V                  +--------+
+--------+                 |
| pid=7  |                 | exits
| ppid=4 | <---------------+
| bash   |
+--------+
    |
    | continues
    V
```
[출처 - Differences between fork and exec](https://stackoverflow.com/questions/1653340/differences-between-fork-and-exec)  
  
bash 에서 ls를 실행시키려면 위와 같이 하면 된다.  
fork로 새로 프로세스 틀을 복사하고    
exec로 복사한 프로세스 틀에다가 그냥 실행하는 내용물만 바꿔 끼워줬다  
  
이렇게 하면  
memory 안에서 복사를 최대한 이용했으므로    
성능상으로 이점을 최대한 챙길 수 있다.  

<br><br>  

# 결론 : fork, exec는 단독으로 쓰이는 게 아니다  
  
1. 프로세스를 새로 띄우려면 HDD 에서 가져와야 하므로 느리다.
2. 따라서 메모리에서 이미 띄운 프로세스를 복사하는 fork를 최대한 쓰는 게 좋다.
3. 그리고 fork로 복사한 프로세스 틀에 exec를 써서, 프로세스 틀을 그대로 재활용하고 실행하는 내용만 바꿔칠 수 있다.
4. 이렇게 최대한 빠르게 프로세스를 실행할 수 있다.  
  
