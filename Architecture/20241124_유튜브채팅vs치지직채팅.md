# 유튜브 채팅 왜이리 느리고 이상해? 
  
유튜브 라이브 채팅을 보다보면  
라이브 딜레이는 해결됐다 하더라도  
채팅이 올라가는 타이밍도 이질적이고 채팅이 많아지면 속도도 급격히 느려진다.   
   
그래서 왜인지 슬쩍 개발자 도구를 열어봤는데...     
   
## 알고보니 HTTP polling 방식  
![image](https://github.com/user-attachments/assets/3b7f7e6f-c042-4c02-96a9-4afdde31b540)   
   
세상에 채팅이 polling 방식이다.   
Polling 으로 만들어진 이유를 추측해보면   
유튜브 라이브 채팅이 아주 오래전에 구현된 시스템이라서  
브라우저 호환성을 고려해 websocket 대신 HTTP polling 으로 구현된 것 같다.  
  
하지만 지금에 이르러서 websocket 은 아주 당연하게 호환되는 스펙이기 때문에 이러한 부분을 고려할 필요가 없다.  
  
<br> 

# Chzzk 의 Websocket 채팅 특징 - 뭉텅이로 채팅 전송  
  
![image](https://github.com/user-attachments/assets/934a8d69-06e5-436b-b4f3-0f1b318224d0)
  
그런데 여기서 핵심은 한번에 뭉텅이로 메세지들을 전달해준다는 점이다.  

### 가장 간단한 생각 - 메세지 수신후 곧바로 제공  
- A 가 채팅 전송
- 서버가 수신 후, 메세지 브로커가 연결된 클라이언트들에게 메세지 전달  
- 클라이언트들이 메세지 수신
  
### chzzk 의 구현 방식 - 어느 정도 쌓아뒀다가 제공  
- A 가 채팅 전송
- 서버 수신. 메세지 브로커는 수신 후 타임아웃까지 대기  
- B 가 채팅 전송
- 서버 수신. 메세지 브로커는 수신 후 타임아우까지 대기
- 채팅 타임아웃. 그동안 쌓인 메세지들을 클라이언트들에게 전송
- 클라이언트들이 메세지 수신
  
아마도 개략적으로 위와 같은 식으로 동작하는 것 같고,    
이렇게 하면 많은 전송 횟수를 절약할 수 있는 좋은 전략이 될 것 같다.  
  
